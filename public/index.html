<!-- <!DOCTYPE html> -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="page-section">
        <h1>URL Shortener</h1>
        <input type="text" id="urlInput" placeholder="Enter a URL">
        <button class="shorten-btn" onclick="shortenURL()">Shorten URL</button>

        <div class="result" id="result"></div>

        <div id="resultContainer" class="result-card" style="display: none;">
            <label>Your Short Link:</label>
            <div class="input-group">
                <input type="text" id="shortUrlDisplay" readonly>
                <button class="copy-btn" onclick="copyLink()">Copy</button>
            </div>
        </div>
    </div>

    <div class="page-section">
        <section class="stats-section">
            <h2>Link Statistics</h2>
            <button onclick="loadStats()">Refresh Stats</button>
            <table id="statsTable">
                <thead>
                    <tr>
                        <th>Original URL</th>
                        <th>Short Code</th>
                        <th>Clicks</th>
                    </tr>
                </thead>
                <tbody id="statsBody">
                    </tbody>
            </table>
        </section>
    </div>

    <script>
        async function shortenURL() {
            const url = document.getElementById('urlInput').value;
            const response = await fetch('/shorten', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url })
            });
            const data = await response.json();
            if (data.shortUrl) {
                const displayInput = document.getElementById('shortUrlDisplay');
                const container = document.getElementById('resultContainer');
                
                displayInput.value = data.shortUrl; // Set the URL in the read-only box
                container.style.display = 'block';  // Show the box
            }
            document.getElementById('result').innerHTML = `Shortened URL: <a href="${data.shortUrl}" target="_blank">${data.shortUrl}</a>`;

            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${data.shortUrl}`;
            document.getElementById('result').innerHTML += `<img src="${qrUrl}" alt="QR Code">`;

        }

        document.getElementById("urlInput").addEventListener("keypress", (e) => {
            if (e.key === "Enter") shortenURL();
        });

        async function copyLink() {
            // 1. Get the input element that holds the shortened URL
            const copyText = document.getElementById("shortUrlDisplay");

            try {
                // 2. Use the Clipboard API to copy the text
                await navigator.clipboard.writeText(copyText.value);

                // 3. User Feedback: Change the button text temporarily
                const copyBtn = document.querySelector('.copy-btn');
                const originalText = copyBtn.innerText;
                
                copyBtn.innerText = "Copied!";
                copyBtn.classList.add('success');

                // Reset the button after 2 seconds
                setTimeout(() => {
                    copyBtn.innerText = originalText;
                    copyBtn.classList.remove('success');
                }, 2000);

            } catch (err) {
                console.error("Failed to copy: ", err);
                alert("Oops, couldn't copy the link automatically.");
            }
        }

        async function loadStats() {
            const response = await fetch('/api/stats');
            const links = await response.json();
            const tableBody = document.getElementById('statsBody');
            
            tableBody.innerHTML = ''; // Clear existing rows

            links.forEach(link => {
                const row = `
                    <tr>
                        <td><div class="truncate">${link.originalUrl}</div></td>
                        <td><code>${link.shortCode}</code></td>
                        <td><span class="badge">${link.clicks || 0}</span></td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Load stats automatically when the page opens
        window.onload = loadStats;
    </script>
</body>
</html> 